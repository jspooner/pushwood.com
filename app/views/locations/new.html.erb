<% content_for :head do %>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<% end %>
<div id="map_canvas"></div>

<h1>New location</h1>

<%= render 'form' %>

<% content_for :script do %>
	<script type="text/javascript">
		$(document).ready(function() {
			var carmelvalley = new google.maps.LatLng(32.94803512647807, -117.23739940536501); 
			var map;
			var marker;
		  var myOptions = {
		    zoom: 12,
		    mapTypeId: google.maps.MapTypeId.ROADMAP
		  };
		  map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			map.setCenter(carmelvalley);
			<% @tricks.each do |trick| %>
				new google.maps.Marker({ map: map,	draggable: true, position: new google.maps.LatLng(<%= trick.lat %>, <%= trick.lng %>) });
			<% end %>
			
			google.maps.event.addListener(map, 'bounds_changed', function() {
				var map_bounds = map.getBounds();
				var ne = map_bounds.getNorthEast();
				var sw = map_bounds.getSouthWest();
				
				$("#location_bounding_box").val( JSON.stringify( { 
																													"ne": { 
																															'lat': ne.lat(), 
																															'lng': ne.lng() 
																																}, 
																													"sw": { 
																															'lat': sw.lat(), 
																															'lng': sw.lng() 
																																} 
																															} ) );
			});
			
			
		});
	</script>
<% end %>
